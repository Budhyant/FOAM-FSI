<?xml version="1.0"?>

<precice-configuration>

   <log-filter target="info" component="" switch="on" />
   <log-filter target="debug" component="" switch="off" />

    <log-output column-separator=" | " log-time-stamp="no"
                log-time-stamp-human-readable="no" log-machine-name="no"
                log-message-type="no" log-trace="yes"/>

   <solver-interface dimensions="3" restart-mode="off" geometry-mode="off">

       <data:scalar name="Acoustics_Density"/>
       <data:scalar name="Acoustics_Velocity_X"/>
       <data:scalar name="Acoustics_Velocity_Y"/>
       <data:scalar name="Acoustics_Velocity_Z"/>
       <data:scalar name="Acoustics_Pressure"/>
       <data:scalar name="Acoustics_Density_Gradient"/>
       <data:scalar name="Acoustics_Velocity_X_Gradient"/>
       <data:scalar name="Acoustics_Velocity_Y_Gradient"/>
       <data:scalar name="Acoustics_Velocity_Z_Gradient"/>
       <data:scalar name="Acoustics_Pressure_Gradient"/>

       <mesh name="Fluid_Acoustics">
         <use-data name="Acoustics_Density"/>
         <use-data name="Acoustics_Velocity_X"/>
         <use-data name="Acoustics_Velocity_Y"/>
         <use-data name="Acoustics_Velocity_Z"/>
         <use-data name="Acoustics_Pressure"/>
         <use-data name="Acoustics_Density_Gradient"/>
         <use-data name="Acoustics_Velocity_X_Gradient"/>
         <use-data name="Acoustics_Velocity_Y_Gradient"/>
         <use-data name="Acoustics_Velocity_Z_Gradient"/>
         <use-data name="Acoustics_Pressure_Gradient"/>
       </mesh>

       <mesh name="Ateles_Acoustics">
         <use-data name="Acoustics_Density"/>
         <use-data name="Acoustics_Velocity_X"/>
         <use-data name="Acoustics_Velocity_Y"/>
         <use-data name="Acoustics_Velocity_Z"/>
         <use-data name="Acoustics_Pressure"/>
         <use-data name="Acoustics_Density_Gradient"/>
         <use-data name="Acoustics_Velocity_X_Gradient"/>
         <use-data name="Acoustics_Velocity_Y_Gradient"/>
         <use-data name="Acoustics_Velocity_Z_Gradient"/>
         <use-data name="Acoustics_Pressure_Gradient"/>
       </mesh>

       <participant name="Fluid_Solver">
         <use-mesh name="Fluid_Acoustics" provide="yes"/>
         <use-mesh name="Ateles_Acoustics" from="Ateles"/>

         <write-data mesh="Fluid_Acoustics" name="Acoustics_Density_Gradient"/>
         <write-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_X_Gradient"/>
         <write-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_Y_Gradient"/>
         <write-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_Z_Gradient"/>
         <write-data mesh="Fluid_Acoustics" name="Acoustics_Pressure_Gradient"/>

         <read-data mesh="Fluid_Acoustics" name="Acoustics_Density"/>
         <read-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_X"/>
         <read-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_Y"/>
         <read-data mesh="Fluid_Acoustics" name="Acoustics_Velocity_Z"/>
         <read-data mesh="Fluid_Acoustics" name="Acoustics_Pressure"/>

         <mapping:nearest-neighbor direction="read" from="Ateles_Acoustics" to="Fluid_Acoustics" constraint="consistent" timing="initial"/>

         <!-- <master:mpi-single /> -->
       </participant>

       <participant name="Ateles">
         <use-mesh name="Ateles_Acoustics" provide="yes"/>
         <use-mesh name="Fluid_Acoustics" from="Fluid_Solver"/>

         <write-data name="Acoustics_Density" mesh="Ateles_Acoustics"/>
         <write-data name="Acoustics_Velocity_X" mesh="Ateles_Acoustics"/>
         <write-data name="Acoustics_Velocity_Y" mesh="Ateles_Acoustics"/>
         <write-data name="Acoustics_Velocity_Z" mesh="Ateles_Acoustics"/>
         <write-data name="Acoustics_Pressure" mesh="Ateles_Acoustics"/>

         <read-data name="Acoustics_Density_Gradient" mesh="Ateles_Acoustics"/>
         <read-data name="Acoustics_Velocity_X_Gradient" mesh="Ateles_Acoustics"/>
         <read-data name="Acoustics_Velocity_Y_Gradient" mesh="Ateles_Acoustics"/>
         <read-data name="Acoustics_Velocity_Z_Gradient" mesh="Ateles_Acoustics"/>
         <read-data name="Acoustics_Pressure_Gradient" mesh="Ateles_Acoustics"/>

         <mapping:nearest-neighbor direction="read" from="Fluid_Acoustics" to="Ateles_Acoustics" constraint="consistent" timing="initial"/>

         <!-- <master:mpi-single /> -->
       </participant>

      <m2n:sockets exchange-directory="../" from="Fluid_Solver" to="Ateles" distribution-type="gather-scatter"/>

      <coupling-scheme:parallel-explicit>
        <participants first="Fluid_Solver" second="Ateles"/>
        <max-timesteps value="900"/>
        <timestep-length value="1e-5"/>
        <exchange data="Acoustics_Density_Gradient" from="Fluid_Solver" to="Ateles" mesh="Fluid_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_X_Gradient" from="Fluid_Solver" to="Ateles" mesh="Fluid_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Y_Gradient" from="Fluid_Solver" to="Ateles" mesh="Fluid_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Z_Gradient" from="Fluid_Solver" to="Ateles" mesh="Fluid_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Pressure_Gradient" from="Fluid_Solver" to="Ateles" mesh="Fluid_Acoustics" initialize="yes"/>

        <exchange data="Acoustics_Density" to="Fluid_Solver" from="Ateles" mesh="Ateles_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_X" to="Fluid_Solver" from="Ateles" mesh="Ateles_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Y" to="Fluid_Solver" from="Ateles" mesh="Ateles_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Velocity_Z" to="Fluid_Solver" from="Ateles" mesh="Ateles_Acoustics" initialize="yes"/>
        <exchange data="Acoustics_Pressure" to="Fluid_Solver" from="Ateles" mesh="Ateles_Acoustics" initialize="yes"/>
      </coupling-scheme:parallel-explicit>

   </solver-interface>

</precice-configuration>
